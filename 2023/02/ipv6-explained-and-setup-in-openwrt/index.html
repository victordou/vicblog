<!doctype html><html lang=zh-hans><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-33RTKT44MP"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-33RTKT44MP",{anonymize_ip:!1})}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="IPv6 原理及如何设置 OpenWrt"><meta itemprop=description content="如果你觉得看文字很无聊 可以看 onemarcfifty 老师的视频，和B站老湿基 IPv6 from scratch - the very basics of IPv6 explained IPv6 explained - SLAAC and DHCPv6 (IPv6 from scratch part 2) IPv6 with OpenWrt https://www.bilibili.com/video/BV1N14y1j7Ku 此文章大部分内容都是引用自 https://github.com/onemarcfifty/cheat-sheets/blob/main/networking/ipv6.md 1. IPv6 地址"><meta itemprop=datePublished content="2023-02-02T13:35:25+08:00"><meta itemprop=dateModified content="2023-02-02T13:35:25+08:00"><meta itemprop=wordCount content="3183"><meta itemprop=keywords content="openwrt,network,"><meta property="og:title" content="IPv6 原理及如何设置 OpenWrt"><meta property="og:description" content="如果你觉得看文字很无聊 可以看 onemarcfifty 老师的视频，和B站老湿基 IPv6 from scratch - the very basics of IPv6 explained IPv6 explained - SLAAC and DHCPv6 (IPv6 from scratch part 2) IPv6 with OpenWrt https://www.bilibili.com/video/BV1N14y1j7Ku 此文章大部分内容都是引用自 https://github.com/onemarcfifty/cheat-sheets/blob/main/networking/ipv6.md 1. IPv6 地址"><meta property="og:type" content="article"><meta property="og:url" content="https://vicfree.com/2023/02/ipv6-explained-and-setup-in-openwrt/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-02T13:35:25+08:00"><meta property="article:modified_time" content="2023-02-02T13:35:25+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="IPv6 原理及如何设置 OpenWrt"><meta name=twitter:description content="如果你觉得看文字很无聊 可以看 onemarcfifty 老师的视频，和B站老湿基 IPv6 from scratch - the very basics of IPv6 explained IPv6 explained - SLAAC and DHCPv6 (IPv6 from scratch part 2) IPv6 with OpenWrt https://www.bilibili.com/video/BV1N14y1j7Ku 此文章大部分内容都是引用自 https://github.com/onemarcfifty/cheat-sheets/blob/main/networking/ipv6.md 1. IPv6 地址"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>IPv6 原理及如何设置 OpenWrt</title><link rel=stylesheet href=https://vicfree.com/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://vicfree.com>Victor</a></div><nav class="site-nav hide-in-mobile"><a href=https://vicfree.com/posts/>Blog</a>
<a href=https://vicfree.com/tags/>Tags</a>
<a href=https://vicfree.com/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/realDonaldTrump target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://t.me/JhKgAA6Hx1 target=_blank rel="noopener me" title=Telegram><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.198 2.433a2.242 2.242.0 00-1.022.215l-8.609 3.33c-2.068.8-4.133 1.598-5.724 2.21a405.15 405.15.0 01-2.849 1.09c-.42.147-.99.332-1.473.901-.728.968.193 1.798.919 2.286 1.61.516 3.275 1.009 4.654 1.472.509 1.793.997 3.592 1.48 5.388.16.36.506.494.864.498l-.002.018s.281.028.555-.038a2.1 2.1.0 00.933-.517c.345-.324 1.28-1.244 1.811-1.764l3.999 2.952.032.018s.442.311 1.09.355c.324.022.75-.04 1.116-.308.37-.27.613-.702.728-1.196.342-1.492 2.61-12.285 2.997-14.072l-.01.042c.27-1.006.17-1.928-.455-2.474a1.654 1.654.0 00-1.034-.407z"/></svg></a><a href=http://www.vicfree.com/qqgroup target=_blank rel="noopener me" title=Qq><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path transform="scale(0.04) translate(75 40)" stroke-width="50" d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741.0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792.0.0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg></a><a href=https://github.com/openwrt/openwrt target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://vicfree.com/posts/>Blog</a></li><li><a href=https://vicfree.com/tags/>Tags</a></li><li><a href=https://vicfree.com/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Feb 2, 2023</span></div><h1>IPv6 原理及如何设置 OpenWrt</h1></header><div class=content><p>如果你觉得看文字很无聊 可以看 onemarcfifty 老师的视频，和B站老湿基</p><ol><li><a href=https://youtu.be/oItwDXraK1M>IPv6 from scratch - the very basics of IPv6 explained</a></li><li><a href=https://youtu.be/jlG_nrCOmJc>IPv6 explained - SLAAC and DHCPv6 (IPv6 from scratch part 2)</a></li><li><a href=https://youtu.be/LJPXz8eA3b8>IPv6 with OpenWrt</a></li><li><a href=https://www.bilibili.com/video/BV1N14y1j7Ku>https://www.bilibili.com/video/BV1N14y1j7Ku</a></li></ol><p>此文章大部分内容都是引用自 <a href=https://github.com/onemarcfifty/cheat-sheets/blob/main/networking/ipv6.md>https://github.com/onemarcfifty/cheat-sheets/blob/main/networking/ipv6.md</a></p><h2 id=1-ipv6-地址含义>1. IPv6 地址含义<a href=#1-ipv6-地址含义 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ul><li><p>IPv6 采用 128位 的地址 (IPv4使用的是32位)，约 340,282,366,920,938,463,463,374,607,431,768,211,456个 IPv6地址。</p></li><li><p>IPv6 因为掩码太长了，手写不方便，就用用<code>/</code>加数字，比如 <code>/64</code>，IPv4也有 <code>/</code> 比如 <code>192.168.0.0/24</code> = <code>192.168.0.0 255.255.255.0</code></p></li><li><p>IPv6 不使用 IPv4 的十进制进行书写，而使用 16进制，可以使用Windows计算器的程序员模式来计算 HEX(16进制) 和 BIN(二进制) 换算。F=1111 E=1110 9=1001。</p><pre><code>  FE80:DEAD:BEEF:BABE:0000:0000:0000:0010
  FE80:DEAD:BEEF:BABE:0:0:0:10 (首位的 0 可以省略，中间和末尾不能省略)
</code></pre></li><li><p>地址中很多重复的 0 可使用 <code>::</code> 进行缩写，方便人类查看。</p><pre><code>  FE80:DEAD:BEEF:BABE::10
</code></pre></li><li><p>但是，同一个地址内只能存在一个 <code>::</code> 缩写，多个 <code>::</code> 会导致地址翻译长地址出错，根据 RFC 5952 而且只缩写最长的0，缩写短的0不符合规则。</p><pre><code>  FE80::1:0:0:1   (正确写法)
  FE80::1::1      (错误写法)
  FE80:0:0:0:1::1（错误写法）
</code></pre></li></ul><h2 id=2-ipv6-scope地址范围>2. IPv6 Scope/地址范围<a href=#2-ipv6-scope地址范围 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><table><thead><tr><th>范围</th><th>含义</th></tr></thead><tbody><tr><td>::1/128</td><td>Loopback 地址 (localhost) 类似 127.0.0.1</td></tr><tr><td>fe80::/10</td><td>Link-Local Unicast (同冲突域，相同交换机下的地址)</td></tr><tr><td>fc00::/7</td><td>Unique-local (本地局域网地址，类似192.168.0.0/24)</td></tr><tr><td>2000::/3</td><td>GLOBAL unicast (互联网地址，就是公网 IP)</td></tr></tbody></table><ul><li><p>每个 IPv6 地址都有 Scope，OpenWrt 可以通过 ssh 内输入 <code>ip a</code> 来查看对应 IPv6 的 Scope.</p><ul><li>scope host</li><li>scope link</li><li>scope global</li></ul></li><li><p>可以用 <a href=https://www.tunnelsup.com/subnet-calculator/>subnet子网计算器</a>来算出 IP 地址范围</p></li></ul><h2 id=3-ipv6-subnet子网>3. IPv6 Subnet/子网<a href=#3-ipv6-subnet子网 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><table><thead><tr><th>掩码位数 (MSB)</th><th>含义</th></tr></thead><tbody><tr><td>最前 48 位:</td><td><strong>ISP 电信网络</strong> 地址</td></tr><tr><td>接着 16 位:</td><td><strong>可划分子网</strong> 地址</td></tr><tr><td>最后 64 位:</td><td><strong>子网内设备</strong> 地址</td></tr></tbody></table><ul><li><p>这个表的意思就是，ISP 比如电信，购买一个 <code>2048:DEAD:BEEF::/48</code> 网段，这个网段可以划分 2^16=65536 个子网，可以分配给 <code>65536</code> 个电信用户使用。每个用户 都能获取到一个 <code>/64</code> 的地址。大部分ISP 都会给你 /56 /60，这样你就可以自己划分子网，多个LAN等。</p></li><li><p><a href=https://learn.microsoft.com/zh-cn/azure/virtual-network/ip-services/ipv6-overview>微软说</a> IPv6 的子网大小只能是 /64。 将来当你决定将子网路由到本地网络时，这种大小可以确保兼容性，因为某些路由器只能接受 /64 IPv6 路由。</p></li></ul><h2 id=4-dhcpv6-vs-slaac>4. DHCPv6 vs SLAAC<a href=#4-dhcpv6-vs-slaac class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ul><li><p><code>Static</code> 固定 IPv6 地址，纯手动输入 IPv6 地址，你吃的很饱可以这么搞。</p></li><li><p><code>SLAAC</code>(stateless address autoconfiguration)，你的电脑读取你的路由器在局域网公告的 Prefix Delegated/PD，来自动设置 IPv6 地址，同时你的电脑也会想局域网公告，我要用自己生成的这个IP，大家没意见我就用了啊。</p></li><li><p><code>DHCPv6</code> 你的电脑，向路由器申请 IPv6 地址，和 IPv4 一样。</p></li></ul><blockquote><p>同一个网口能同时拥有多个 IPv4 地址，IPv6 也一样，大部分设备都是同时打开 SLAAC + DHCPv6，所以你的电脑可以获取很多个 IPv6地址。</p></blockquote><h1 id=openwrt-实践>OpenWrt 实践<a href=#openwrt-实践 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><blockquote><p>默认 OpenWrt 会默认自带 IPv6 的设置，但是有设置还不够，需要安装 IPv6 组件，OpenWrt官方最低要求：DHCPv6 客户端 (<strong>odhcp6c</strong>), RA & DHCPv6 服务器 (<strong>odhcpd</strong>) 和 IPv6 防火墙 (<strong>ip6tables</strong>) 还有 Luci网页配置 的 (<strong>luci-proto-ipv6</strong>）</p></blockquote><blockquote><p>因为默认 IPv6 全部都是公网，没有 NAT地址 转换，所以要记住 IPv6 地址流动方向是从 <code>WAN</code> -> <code>LAN</code> -> <code>二级路由 WAN</code> -> <code>二级路由 LAN</code>，为了让下级端口获取 <code>Prefix Delegated/PD</code>，或 <code>DHCPv6 Relay</code>，那么上级的端口就需要开启 <code>Delegate IPv6 prefixes/委托 IPv6 前缀</code> 或 <code>Relay/中继</code></p></blockquote><ul><li><p>什么是 Unique-Local 地址，类似本地局域网地址 如 192.168.0.0/24，供内部局域网使用，没有 IPv6 公网的人可以打开，有 IPv6 公网就可以关掉了。</p><ul><li>进入<code>OpenWrt</code> - <code>Network/网络</code> - <code>Interfaces/接口</code> - <code>Global network options/全局网络选项</code></li><li><code>IPv6 ULA-Prefix/IPv6 ULA 前缀</code>，这里可以填写任意 fc00::/7 地址内 最大 FDFF 的地址，<a href=https://www.tunnelsup.com/subnet-calculator/>subnet子网计算器</a></li></ul></li><li><p>从 PPPOE 获取 IPv6 PD 地址</p><ul><li><code>OpenWrt</code> - Network/网络 - Interfaces/接口<ul><li><code>WAN</code> - <code>Edit/编辑</code> - <code>Advanced Settings/高级设置</code><ul><li><code>Obtain IPv6 address/获取 IPv6 地址</code> - <code>Automatic/自动</code>。如果选择 <code>Manual/手动</code>，将会关闭 DHCPv6 和 SLAAC。</li><li><code>Delegate IPv6 prefixes/委托 IPv6 前缀</code> - <code>打勾✓</code>，如果不打勾，路由器 LAN口 将不会自动分配到 公网IPv6 地址。</li></ul></li></ul></li></ul></li><li><p>从 DHCPv6 获取 IPv6 PD 地址（这种情况大多是二级路由，不能拨号的人就用这个）</p><ul><li>新增一个 DHCPv6 的 <code>WAN6</code> 接口（默认就有，没有就新增）</li><li><code>WAN6</code> - <code>Edit/编辑</code><ul><li><code>Request IPv6-address/请求 IPv6 地址</code> - 选择<code>try</code></li><li><code>Request IPv6-prefix of length/请求指定长度的 IPv6 前缀</code> - 选择<code>Automatic/自动</code> 因为每个 ISP/运营商 分配的掩码都不一样，/56 /60 /64 都有，这里请选择自动吧。</li><li><code>Advanced Settings/高级设置</code> - <code>Delegate IPv6 prefixes/委托 IPv6 前缀</code> - 选择<code>打勾✓</code>，如果不打勾 路由器 LAN口 将不会自动分配到 公网IPv6 地址。</li></ul></li></ul></li></ul><ul><li><p>如存在二级路由，主路由LAN设置，选择<code>LAN</code> - <code>Edit/编辑</code> - <code>Advanced Settings/高级设置</code></p><ul><li><code>Delegate IPv6 prefixes/委托 IPv6 前缀</code> - <code>打勾✓</code>，如果不打勾，你的二级路由将不会获取 公网IPv6 分配规则。</li><li><code>IPv6 assignment length/IPv6 分配长度</code> - 上面说到，ISP 可分配长度为 48-64，假如ISP 给你 WAN 分配 60，你这里就改 60。如果你有多 LAN，或者二级路由，请合理分配子网。</li></ul></li><li><p>路由器开启 DHCPv6 服务，进入 LAN - <code>Edit/编辑</code> - <code>DHCP Server/服务器</code> - <code>IPv6 Setting/设置</code></p><ul><li><code>RA 服务</code>，Router Advertisement，路由通告，路由器主动在网络上告诉局域网，我是路由器。</li><li><code>DHCPv6</code>, 字面意思，分配IP的。</li><li><code>NDP 代理</code>，Neighbour Discovery Protocol Proxy，上下级路由之间转发 <code>Neighbor Solicitation + Neighbor Advertisement</code>，适用于二级路由使用上级路由的 IPv6地址。视频3最后一部分有讲到。</li><li><strong>relay/中继模式</strong>，转发 上级路由/ISP IPv6 参数</li><li><strong>server/服务器模式</strong>，路由器自己作为服务器，分发 IPv6 参数</li><li><strong>hybrid/混合模式</strong>，路由器先尝试转发 上级路由/ISP 的参数，如果 ISP 没有，则自己作为服务器分发 IPv6 参数。</li><li>供参考：RA+DHCPv6 设置为 <code>server/服务器模式</code>，NDP 代理选择<code>禁用</code></li><li><code>IPv6 RA Settings/设置</code> - <code>Enable SLAAC</code> - <code>推荐不要勾</code> SLAAC时，OpenWrt没办法控制地址分发，其他设置尽量不要动</li></ul></li><li><p>个性化路由器 IPv6 地址段，进入任意接口 - Edit/编辑 - Advanced Settings/高级设置</p><ul><li><code>Use default gateway/使用默认网关</code>，<code>取消勾选✓</code>，作用未明，<code>Replace existing default route on PPP connect</code></li><li><code>IPv6 assignment hint/分配提示</code><ul><li>比如 ISP 分配给你 <code>2048:DEAD:BEEF:bab0::/60</code>，<code>/60</code> 说明你可以分配 16个 <code>/64</code> 的 多LAN口/多子网，这里填 <code>e</code>，你的 LAN IPv6 地址 就会变成 <code>2048:DEAD:BEEF:babe::1/64</code> 与其他 LAN 做区分。</li></ul></li><li><code>IPv6 suffix/后缀</code><ul><li>比如 ISP 分配给你 <code>2048:DEAD:BEEF:bab0::/60</code>，填 <code>99</code> 你的 LAN IPv6 地址 就会变成 <code>2048:DEAD:BEEF:bab0::99/60</code></li></ul></li></ul></li><li><p>个性化电脑 IPv6 地址</p><ul><li>进入<code>OpenWrt</code> - <code>Network/网络</code> - <code>DHCP/DNS</code> - <code>Static Lease/静态地址分配</code> - <code>新增/修改静态分配条目</code> - <code>IPv6-Suffix/后缀</code> - 填写任意4位以下16进制数 如<code>1234</code>或者<code>DEAD</code>。</li></ul></li></ul><h2 id=防火墙>防火墙<a href=#防火墙 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><blockquote><p>全世界都可以 Ping 通你的公网 IPv6地址，那是因为OpenWrt防火墙通信规则开通了Ping <code>Allow-ICMPv6-Input</code>，你不想被 Ping，可以关闭。</p></blockquote><ul><li>举个<a href=https://openwrt.org/docs/guide-user/firewall/fw3_configurations/fw3_ipv6_examples>官方文档</a>里的例子</li></ul><pre tabindex=0><code>uci add firewall rule
uci set firewall.@rule[-1].name=&#34;Forward-IPv6&#34;
uci set firewall.@rule[-1].src=&#34;wan&#34;
uci set firewall.@rule[-1].dest=&#34;lan&#34;
uci set firewall.@rule[-1].dest_ip=&#34;::DEAD/-64&#34;
uci set firewall.@rule[-1].family=&#34;ipv6&#34;
uci set firewall.@rule[-1].proto=&#34;tcp udp&#34;
uci set firewall.@rule[-1].target=&#34;ACCEPT&#34;
uci commit firewall
/etc/init.d/firewall restart
</code></pre><h2 id=ipv6-的使用>IPv6 的使用<a href=#ipv6-的使用 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ul><li><p>使用IPv6地址访问 Web网页需要加 <code>[]</code>，<code>http://[2048:DEAD:BEEF:bab0::99]</code> 或者 <code>http://[2048:DEAD:BEEF:bab0::99]:80</code></p></li><li><p>还是弄域名吧，谁要记这么长的地址。</p></li><li><p>IPv6 组播地址，<a href=https://www.iana.org/assignments/ipv6-multicast-addresses/ipv6-multicast-addresses.xhtml>完整清单见 IANA</a></p></li></ul><table><thead><tr><th>地址</th><th>含义</th></tr></thead><tbody><tr><td>ff02::1</td><td>内网所有IPv6设备</td></tr><tr><td>ff02::2</td><td>内网所有路由器（主动通过RA通告自己是路由器）</td></tr><tr><td>ff02::fb</td><td>mDNSv6（HomeKit, AirPlay 会用到）</td></tr><tr><td>ff02::1:2</td><td>内网所有DHCP服务器（主动通过RA通告自己DHCP服务器）</td></tr><tr><td>ff02::101</td><td>内网所有NTP服务器（同上）</td></tr></tbody></table><h3 id=单播unicast-组播multicast-任播anycast-广播broadcast>单播/Unicast 组播/Multicast 任播/Anycast 广播/Broadcast<a href=#单播unicast-组播multicast-任播anycast-广播broadcast class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><ul><li><code>IPV6</code> 没有 广播/Broadcast</li><li><code>单播/Unicast</code>: 一对一，俗称私聊</li><li><code>组播/Multicast</code>: 群聊，加群的才能收到信息，可随时加群退群。</li><li><code>任播/Anycast</code>: 多个服务器拥有相同的 IP地址，客户端会选择最近的进行链接，比如打电话给 119，会自动路由到你家附近的消防站。</li><li><code>广播/Broadcast</code>: 类似广场舞的喇叭，除非断网，否则你会一直听到广场舞的声音。</li></ul></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://vicfree.com/tags/openwrt>openwrt</a></span><span class=tag><a href=https://vicfree.com/tags/network>network</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>3183 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2023-02-02 05:35 +0000</p></footer></article><div class="post-nav thin"><a class=prev-post href=https://vicfree.com/2023/01/truenas-setup-guide/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>TruenNAS 设置经验分享</span></a></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//vicfree.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2023 <a href=https://vicfree.com>Victor</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://vicfree.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://vicfree.com/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin=anonymous></script></body></html>