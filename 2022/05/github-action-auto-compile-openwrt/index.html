<!doctype html><html lang=zh-hans><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-33RTKT44MP"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-33RTKT44MP",{anonymize_ip:!1})}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="利用 Github Action 自动编译OpenWrt"><meta itemprop=description content="本次教程基于下列前车之鉴 https://github.com/coolsnowwolf/lede https://github.com/KFERMercer/OpenWrt-CI 注册Github 本步骤跳过，网上一大堆 Fork Openwrt https://github.com/coolsnowwolf/lede/fork 开启Github Action 进入你 fork 成功后的lede/openwrt 进入 Action 阅读"><meta itemprop=datePublished content="2022-05-17T15:21:34+08:00"><meta itemprop=dateModified content="2022-05-17T15:21:34+08:00"><meta itemprop=wordCount content="986"><meta itemprop=keywords content="openwrt,Github,"><meta property="og:title" content="利用 Github Action 自动编译OpenWrt"><meta property="og:description" content="本次教程基于下列前车之鉴 https://github.com/coolsnowwolf/lede https://github.com/KFERMercer/OpenWrt-CI 注册Github 本步骤跳过，网上一大堆 Fork Openwrt https://github.com/coolsnowwolf/lede/fork 开启Github Action 进入你 fork 成功后的lede/openwrt 进入 Action 阅读"><meta property="og:type" content="article"><meta property="og:url" content="https://vicfree.com/2022/05/github-action-auto-compile-openwrt/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-17T15:21:34+08:00"><meta property="article:modified_time" content="2022-05-17T15:21:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="利用 Github Action 自动编译OpenWrt"><meta name=twitter:description content="本次教程基于下列前车之鉴 https://github.com/coolsnowwolf/lede https://github.com/KFERMercer/OpenWrt-CI 注册Github 本步骤跳过，网上一大堆 Fork Openwrt https://github.com/coolsnowwolf/lede/fork 开启Github Action 进入你 fork 成功后的lede/openwrt 进入 Action 阅读"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>利用 Github Action 自动编译OpenWrt</title><link rel=stylesheet href=https://vicfree.com/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://vicfree.com>Victor</a></div><nav class="site-nav hide-in-mobile"><a href=https://vicfree.com/posts/>Blog</a>
<a href=https://vicfree.com/tags/>Tags</a>
<a href=https://vicfree.com/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/realDonaldTrump target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://t.me/JhKgAA6Hx1 target=_blank rel="noopener me" title=Telegram><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.198 2.433a2.242 2.242.0 00-1.022.215l-8.609 3.33c-2.068.8-4.133 1.598-5.724 2.21a405.15 405.15.0 01-2.849 1.09c-.42.147-.99.332-1.473.901-.728.968.193 1.798.919 2.286 1.61.516 3.275 1.009 4.654 1.472.509 1.793.997 3.592 1.48 5.388.16.36.506.494.864.498l-.002.018s.281.028.555-.038a2.1 2.1.0 00.933-.517c.345-.324 1.28-1.244 1.811-1.764l3.999 2.952.032.018s.442.311 1.09.355c.324.022.75-.04 1.116-.308.37-.27.613-.702.728-1.196.342-1.492 2.61-12.285 2.997-14.072l-.01.042c.27-1.006.17-1.928-.455-2.474a1.654 1.654.0 00-1.034-.407z"/></svg></a><a href=http://www.vicfree.com/qqgroup target=_blank rel="noopener me" title=Qq><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path transform="scale(0.04) translate(75 40)" stroke-width="50" d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741.0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792.0.0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg></a><a href=https://github.com/openwrt/openwrt target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://vicfree.com/posts/>Blog</a></li><li><a href=https://vicfree.com/tags/>Tags</a></li><li><a href=https://vicfree.com/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>May 17, 2022</span></div><h1>利用 Github Action 自动编译OpenWrt</h1></header><div class=content><h2 id=本次教程基于下列前车之鉴>本次教程基于下列前车之鉴<a href=#本次教程基于下列前车之鉴 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p><a href=https://github.com/coolsnowwolf/lede>https://github.com/coolsnowwolf/lede</a></p><p><a href=https://github.com/KFERMercer/OpenWrt-CI>https://github.com/KFERMercer/OpenWrt-CI</a></p><h2 id=注册github>注册Github<a href=#注册github class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>本步骤跳过，网上一大堆</p><h2 id=fork-openwrt>Fork Openwrt<a href=#fork-openwrt class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p><a href=https://github.com/coolsnowwolf/lede/fork>https://github.com/coolsnowwolf/lede/fork</a></p><h2 id=开启github-action>开启Github Action<a href=#开启github-action class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ol><li>进入你 <code>fork</code> 成功后的lede/openwrt</li><li>进入 <code>Action</code></li><li>阅读后打勾，启用 <code>Action</code></li></ol><h2 id=准备workflows配置文件>准备Workflows配置文件<a href=#准备workflows配置文件 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ol><li>打开<a href=https://github.com/KFERMercer/OpenWrt-CI/blob/master/openwrt-ci.yml>KFERMercer OpenWrt-CI.yml</a></li><li>复制全部内容</li></ol><h2 id=编辑workflows配置文件>编辑Workflows配置文件<a href=#编辑workflows配置文件 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ol><li>返回你的OpenWrt的 <code>Code</code> 页面</li><li>依次打开 <code>.github/workflows/</code> 文件夹</li><li>打开 <code>openwrt-ci.yml</code></li><li>粘贴你之前复制的.yml内容</li><li>根据你的要求自定义yml的内容</li><li>修改完成 <code>Start commit</code> -> <code>Commit changes</code></li></ol><h2 id=此时你的-openwrt-会自动开始编译>此时你的 OpenWrt 会自动开始编译<a href=#此时你的-openwrt-会自动开始编译 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>时长越两小时，下载OpenWrt_firmware即可</p><h2 id=如何自定义固件>如何自定义固件<a href=#如何自定义固件 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ol><li>找到你需要安装的包名，官方<a href=https://openwrt.org/packages/index/start>https://openwrt.org/packages/index/start</a></li><li>Lean/coolsnowwolf 的软件包可以从 make defconfig 配置文件 <code>.config</code> 中找到</li><li>添加包到<code>openwrt-ci.yml</code> 中 <code>cat >> .config &lt;&lt;EOF</code>后面</li></ol><p>以下删除网易云+迅雷快鸟，并添加一堆自用软件baidupcs, mwan3, ipv6, DOH, Cloudflare DDNS, SMB映射等。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># This is free software, lisence use MIT.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Copyright (C) 2019 P3TERX &lt;https://p3terx.com&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Copyright (C) 2020 KFERMercer &lt;KFER.Mercer@gmail.com&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># &lt;https://github.com/KFERMercer/OpenWrt-CI&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OpenWrt-CI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># schedule:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#   - cron: 0 20 * * *</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>release</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>types</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>published]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build_openwrt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build OpenWrt firmware</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.event.repository.owner.id == github.event.sender.id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Space cleanup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>DEBIAN_FRONTEND</span><span class=p>:</span><span class=w> </span><span class=l>noninteractive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          docker rmi `docker images -q`
</span></span></span><span class=line><span class=cl><span class=sd>          sudo rm -rf /usr/share/dotnet /etc/mysql /etc/php /etc/apt/sources.list.d /usr/local/lib/android
</span></span></span><span class=line><span class=cl><span class=sd>          sudo -E apt-get -y purge azure-cli ghc* zulu* hhvm llvm* firefox google* dotnet* powershell openjdk* adoptopenjdk* mysql* php* mongodb* dotnet* moby* snapd* || true
</span></span></span><span class=line><span class=cl><span class=sd>          sudo -E apt-get update
</span></span></span><span class=line><span class=cl><span class=sd>          sudo -E apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs gcc-multilib g++-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler antlr3 gperf swig libtinfo5
</span></span></span><span class=line><span class=cl><span class=sd>          sudo -E apt-get -y autoremove --purge
</span></span></span><span class=line><span class=cl><span class=sd>          sudo -E apt-get clean
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          # sudo mkdir -p -m 777 /mnt/openwrt/bin /mnt/openwrt/build_dir/host /mnt/openwrt/build_dir/hostpkg /mnt/openwrt/dl /mnt/openwrt/feeds /mnt/openwrt/staging_dir
</span></span></span><span class=line><span class=cl><span class=sd>          # ln -s /mnt/openwrt/bin ./bin
</span></span></span><span class=line><span class=cl><span class=sd>          # mkdir -p ./build_dir
</span></span></span><span class=line><span class=cl><span class=sd>          # ln -s -f /mnt/openwrt/build_dir/host ./build_dir/host
</span></span></span><span class=line><span class=cl><span class=sd>          # ln -s -f /mnt/openwrt/build_dir/hostpkg ./build_dir/hostpkg
</span></span></span><span class=line><span class=cl><span class=sd>          # ln -s /mnt/openwrt/dl ./dl
</span></span></span><span class=line><span class=cl><span class=sd>          # ln -s /mnt/openwrt/feeds ./feeds
</span></span></span><span class=line><span class=cl><span class=sd>          # ln -s /mnt/openwrt/staging_dir ./staging_dir
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          df -h</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Update feeds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;src-git helloworld https://github.com/fw876/helloworld.git&#34; &gt;&gt; &#34;feeds.conf.default&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          ./scripts/feeds update -a
</span></span></span><span class=line><span class=cl><span class=sd>          ./scripts/feeds install -a</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Generate configuration file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          rm -f ./.config*
</span></span></span><span class=line><span class=cl><span class=sd>          touch ./.config
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          #
</span></span></span><span class=line><span class=cl><span class=sd>          # 在 cat &gt;&gt; .config &lt;&lt;EOF 到 EOF 之间粘贴你的编译配置, 需注意缩进关系
</span></span></span><span class=line><span class=cl><span class=sd>          # 例如:
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          cat &gt;&gt; .config &lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_LUCI_LANG_en=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_LUCI_LANG_zh-cn=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-baidupcs-web=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-cifs-mount=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-wireguard=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-https-dns-proxy=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-netdata=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-p910nd=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-ssr-plus=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-ssr-plus_INCLUDE_Hysteria=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-ssr-plus_INCLUDE_IPT2Socks=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-ssr-plus_INCLUDE_Trojan=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_DNSFORWARDER=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_DNSPROXY=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-uugamebooster=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-app-syncdial=y
</span></span></span><span class=line><span class=cl><span class=sd>          # CONFIG_PACKAGE_luci-app-unblockmusic is not set
</span></span></span><span class=line><span class=cl><span class=sd>          # CONFIG_PACKAGE_luci-app-ttyd is not set
</span></span></span><span class=line><span class=cl><span class=sd>          # CONFIG_PACKAGE_luci-app-xlnetacc is not set
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-theme-argon=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-theme-bootstrap=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-theme-material=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_luci-theme-netgear=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_ddns-scripts_cloudflare.com-v4=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_ddns-scripts_no-ip_com=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_ddns-scripts_route53-v1=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_bind-dig=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_nano=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_qrencode=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_open-vm-tools=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_whois=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_nmap-ssl=y
</span></span></span><span class=line><span class=cl><span class=sd>          CONFIG_PACKAGE_ipv6helper=y
</span></span></span><span class=line><span class=cl><span class=sd>          EOF
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          #
</span></span></span><span class=line><span class=cl><span class=sd>          # ===============================================================
</span></span></span><span class=line><span class=cl><span class=sd>          # 
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          sed -i &#39;s/^[ \t]*//g&#39; ./.config
</span></span></span><span class=line><span class=cl><span class=sd>          make defconfig</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Make download</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          make download -j8 || make download -j1 V=s
</span></span></span><span class=line><span class=cl><span class=sd>          rm -rf $(find ./dl/ -size -1024c)
</span></span></span><span class=line><span class=cl><span class=sd>          df -h</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Compile firmware</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          make -j$(nproc) || make -j1 V=s
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;=======================&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;Space usage:&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;=======================&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          df -h
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;=======================&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          du -h ./ --max-depth=1
</span></span></span><span class=line><span class=cl><span class=sd>          du -h /mnt/openwrt/ --max-depth=1 || true</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Prepare artifact</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          mkdir -p ./artifact/firmware
</span></span></span><span class=line><span class=cl><span class=sd>          mkdir -p ./artifact/package
</span></span></span><span class=line><span class=cl><span class=sd>          mkdir -p ./artifact/buildinfo
</span></span></span><span class=line><span class=cl><span class=sd>          rm -rf $(find ./bin/targets/ -type d -name &#34;packages&#34;)
</span></span></span><span class=line><span class=cl><span class=sd>          cp -rf $(find ./bin/targets/ -type f) ./artifact/firmware/
</span></span></span><span class=line><span class=cl><span class=sd>          cp -rf $(find ./bin/packages/ -type f -name &#34;*.ipk&#34;) ./artifact/package/
</span></span></span><span class=line><span class=cl><span class=sd>          cp -rf $(find ./bin/targets/ -type f -name &#34;*.buildinfo&#34; -o -name &#34;*.manifest&#34;) ./artifact/buildinfo/</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deliver buildinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/upload-artifact@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OpenWrt_buildinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./artifact/buildinfo/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deliver package</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/upload-artifact@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OpenWrt_package</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./artifact/package/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deliver firmware</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/upload-artifact@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OpenWrt_firmware</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./bin/targets/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upload release asset</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.event == &#39;release&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>svenstaro/upload-release-action@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>repo_token</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.YOURTOKEN }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>./artifact/firmware/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.ref }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>file_glob</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><h2 id=如何手动开始编译不需要手动commit>如何手动开始编译，不需要手动commit<a href=#如何手动开始编译不需要手动commit class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ol><li>先更新你的OpenWrt源-> <code>Fetch upstream</code> -> <code>Fetch Merge</code></li><li>修改 <code>openwrt-ci.yml</code></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>master</span><span class=w>
</span></span></span></code></pre></div><p>改成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><ol start=3><li>手动开始编译 <code>Action</code> -> <code>OpenWrt-CI</code> -> <code>Run workflow</code></li></ol><h2 id=添加ssr-plus>添加SSR PLUS<a href=#添加ssr-plus class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>我上面的配置已经添加了<a href=https://github.com/fw876/helloworld>这一段命令</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;src-git helloworld https://github.com/fw876/helloworld.git&#34;</span> &gt;&gt; <span class=s2>&#34;feeds.conf.default&#34;</span>
</span></span></code></pre></div></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://vicfree.com/tags/openwrt>openwrt</a></span><span class=tag><a href=https://vicfree.com/tags/github>Github</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>986 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-05-17 07:21 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://vicfree.com/2022/07/traefik-cert-export/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>traefik acme 证书导出</span></a>
<a class=prev-post href=https://vicfree.com/2022/04/install-sonarr-radarr-jackett-with-docker-compose/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>一键安装 Sonarr Radarr Jackett 追剧一条龙</span></a></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//vicfree.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2022 <a href=https://vicfree.com>Victor</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://vicfree.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://vicfree.com/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin=anonymous></script></body></html>